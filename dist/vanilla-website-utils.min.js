"use strict";module.exports=class Vanilla_website_utils{constructor(){}shuffle_array(e,t=0){(t>e.length||0===t)&&(t=e.length);for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e.slice(0,t)}remove_tags(){let e=str;return null!==str&&""!==str&&(str=str.toString(),e=str.replace(/(<([^>]+)>)/gi,""),e=e.trim(),e)}is_number(e){return"string"==typeof e&&!isNaN(e)&&!isNaN(parseFloat(e))}round(e,t=0){if("string"==typeof e&&!1===this.is_number(e))return e;if(e>0){let n=10;for(let e=1;e<t;e++)n*=10;e=Math.round(e*n)/n}else e=Math.round();return e}async get_month_back(e=0){const t=["January","February","March","April","May","June","July","August","September","October","November","December"];let n={};const r=new Date;let a=r.getFullYear(),o=r.getMonth(),l=r.getDate().toString().padStart(2,"0"),s=a+(o+1).toString().padStart(2,"0");for(let r=0;r<e+1;r++){let e=a-r;for(let r=0;r<t.length;r++){let a=e+""+(r+1).toString().padStart(2,"0");if(a<=s){const o=a+"01";let i=a+""+new Date(e,r+1,0).getDate();a===s&&(i=s+""+l);const c=t[r]+" "+e;n[o]={start:o,end:i,name:c}}}}let i=[],c=Object.keys(n).sort().reverse();for(let e in c)i.push(n[c[e]]);return i}async csv_file_to_array(e){let t=[];const n=(await e.text()).split(/[\r\n]+/);for(let e in n){let r=n[e].split(/\s*,\s*/).map(e=>""===e?"":isNaN(Number(e))?e:Number(e));t.push(r)}return t}clear_textarea(){let e=document.getElementsByTagName("textarea");for(let t in e)"textarea"===e[t].type&&(e[t].value="")}sort_object(e,t="desc"){let n=[];for(let t in e)n.push([t,e[t]]);return n.sort(function(e,n){return"asc"===t?e[1]-n[1]:n[1]-e[1]}),n}from_112_to_date(e,t=0){const n=e.substring(0,4),r=e.substring(4,6),a=e.substring(6,8),o=parseInt(n),l=parseInt(r),s=parseInt(a);let i=new Date(o,l-1,s);return i.setDate(i.getDate()+t),i}date_to_112(e){return e.getUTCFullYear()+""+this.pad(e.getMonth()+1)+this.pad(e.getDate())}async month_list(month_back=12,revert=!1,format="`${j}.${i}`"){let date=new Date;date.setMonth(date.getMonth()-month_back);let startDate=String(date.getMonth()+1)+"."+String(date.getFullYear()),data=[],d=new Date,m=d.getMonth()+1,y=d.getFullYear().toString();d=startDate.split(".");let counter=parseInt(d[0]);for(var i=parseInt(d[1]);i<=parseInt(y);i++){for(var j=counter;j<=12;j++){if(j>m&&i==y)continue;j<10&&(j="0"+j);let f=eval(format);data.push(f)}counter=1}return!0===revert&&(data=data.reduce((e,t)=>[t].concat(e),[])),data}async get_host(e="html"){let t=String(location).split("/");for(let n=1;n<t.length;n++)if(t[n].indexOf(".")>0&&t[n].indexOf(e)<0)return t[n];return!1}async clean_url_parameters(){const e=window.location.href.split("?")[0],t=await this.get_parameters();let n={};for(let e in t)""!=t[e]&&"none"!=t[e]&&(t[e].constructor===Array?n[e]=t[e].join(","):n[e]=t[e]);const r=await vwu.add_parameters(e,n);window.history.pushState(null,null,r)}async get_parameters(e){e||(e=window.location.href);let t=e.indexOf("?"),n=e.indexOf("#");if(-1==n&&-1==t)return{};-1==n&&(n=e.length);let r=-1==t||n==t+1?e.substring(n):e.substring(t+1,n);var a={};return r.split("&").forEach(function(e){if(!e)return;let t=(e=e.split("+").join(" ")).indexOf("="),n=t>-1?e.substr(0,t):e,r=t>-1?decodeURIComponent(e.substr(t+1)):"",o=n.indexOf("[");if(r.indexOf("\r\n")>-1?r=r.split("\r\n"):r.indexOf("\n")>-1&&(r=r.split("\n")),-1==o){let e=decodeURIComponent(n);a[e]?(Array.isArray(a[e])||(a[e]=[a[e]]),a[e].push(r)):a[e]=r}else{let e=n.indexOf("]",o);var l=decodeURIComponent(n.substring(o+1,e));n=decodeURIComponent(n.substring(0,o)),a[n]||(a[n]=[]),l?a[n][l]=r:a[n].push(r)}}),a}async get_select_text_by_value(e,t,n="All"){for(var r=0;r<e.length;r++){const n=e.options[r];if(n.value==t)return n.text}return n}async add_parameters(e,t){let n="?";e.indexOf("?")>-1&&(n="&");for(let r in t)e+=n+r+"="+t[r],n="&";return e}async afetch_all(e,...t){let n=[];for(let e in t)n.push(this.afetch(e,t[e]));this.wait_for_all(...n).then(t=>e(t))}wait_for_all(...e){return Promise.all(e.map(this.handle_rejection))}async afetch(e,t){const n=await fetch(t),r=await n.json();return[parseInt(e),r]}handle_rejection(e){return e.catch(e=>({error:e}))}async aget_api(e,t="",n="",r=""){return new Promise((a,o)=>{let l=new XMLHttpRequest;if(l.open("GET",e,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),""!=t&&""!=n){const e=btoa(t+":"+n);l.setRequestHeader("Authorization","Basic "+e)}else""!=r&&l.setRequestHeader("Authorization","Bearer "+r);l.onload=function(){return a(l.responseText)},l.onerror=function(){return o(l.statusText)},l.send(null)})}async aput_api(e,t,n="application/json"){return"object"==typeof t&&(t=JSON.stringify(filter)),new Promise((n,r)=>{let a=new XMLHttpRequest;a.open("PUT",e),a.setRequestHeader("Content-type","application/json"),a.onload=()=>n(a.responseText),a.onerror=()=>r(a.statusText),a.send(t)})}async apost_api(e,t,n="application/json"){return new Promise((r,a)=>{let o=new XMLHttpRequest;o.open("POST",e),o.setRequestHeader("Content-type",n),o.onload=()=>r(o.responseText),o.onerror=()=>a(o.statusText),o.send(t)})}post_api(e,{},t,n={},r="application/json"){let a=new XMLHttpRequest;a.open("POST",e),a.setRequestHeader("Content-type",r),a.onload=function(){if(200===a.status){let e=JSON.parse(a.responseText);t(e,!0,n)}else t(a.responseText,!1,n)},a.onerror=function(){t(a,!1,n)},a.send(n)}_email_validator(e){if(!e)return!1;if(e.length>254)return!1;if(!/^[-!#$%&'*+\/0-9=?A-Z^_a-z{|}~](\.?[-!#$%&'*+\/0-9=?A-Z^_a-z`{|}~])*@[a-zA-Z0-9](-?\.?[a-zA-Z0-9])*\.[a-zA-Z](-?[a-zA-Z0-9])+$/.test(e))return!1;let t=e.split("@");return!(t[0].length>64)&&!t[1].split(".").some(function(e){return e.length>63})}async email_validator(e){if(!e)return!1;if(e.length>254)return!1;if(!/^[-!#$%&'*+\/0-9=?A-Z^_a-z{|}~](\.?[-!#$%&'*+\/0-9=?A-Z^_a-z`{|}~])*@[a-zA-Z0-9](-?\.?[a-zA-Z0-9])*\.[a-zA-Z](-?[a-zA-Z0-9])+$/.test(e))return!1;let t=e.split("@");return!(t[0].length>64)&&!t[1].split(".").some(function(e){return e.length>63})}async get_url_parameter(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null}async get_site(){let e=String(location).split("/");return e[e.length-1].replace(".html","")}async autocomplete_textfield(e){!!e.data&&e.data;let t=!!e.url&&e.url,n=!!e.dom_id&&e.dom_id,r=!!e.name&&e.name,a=e.type_delay?e.type_delay:500,o=!!e.search_indicator&&e.search_indicator,l=e.min_key_length?e.min_key_length:3,s=1==e.onetimeload&&e.onetimeload,i=e.min_dropdown?e.min_dropdown:20,c=!!e.append_to&&e.append_to;const u=e.search?e.search:"beginning";t&&(!0===s&&t&&n&&r?this.autocomplete_onetime(t,n,r,l,i,c,u):this._set_textfield(t,n,r,l,o,a,i,c,u))}async autocomplete_select(e){let t=!!e.url&&e.url,n=!!e.dom_id&&e.dom_id,r=e.selected?e.selected:"";!!e.name&&e.name;if(t){let e=document.querySelector("#"+n),a=JSON.parse(await this.aget_api(t));this.fill_select(e,a,r)}}async autocomplete_onetime(e,t,n,r,a,o,l){let s=this,i=document.querySelector("#"+t);if(i){i.setAttribute("placeholder","Loading "+n+"..."),i.setAttribute("autocomplete","off");let t=i.getAttribute("class");i.setAttribute("class",t+" autocomplete");let c=await this.aget_api(e);if(c.length){let e=JSON.parse(c);if(e instanceof Array){let t={};for(let n=0;n<e.length;n++)t[e[n]]=e[n];e=t}i.placeholder="Enter "+n+"...",i.addEventListener("keyup",async function(t){t.target.value.length>=r&&await s.autocomplete(t.target.value,i,e,a,o,l)})}}}async _set_textfield(e="html",t="domid",n="",r=3,a,o,l,s,i){let c=function(){let e=0;return function(t,n){clearTimeout(e),e=setTimeout(t,n)}}(),u=this,d=document.querySelector("#"+t);if(d){d.setAttribute("placeholder","Enter "+n+"..."),d.setAttribute("autocomplete","off");let a=d.getAttribute("class");d.setAttribute("class",a+" autocomplete"),d.addEventListener("keyup",async function(a){c(async function(){await u.autocomplete_keylog(a,d,e,t,n,r,l,ppend_to,i)},o)})}return!1}async autoload_textfield(e="html",t="domid",n="",r,a){this._set_textfield(e,t,n)}async autocomplete_keylog(e,t,n,r,a,o=3,l=20,s=!1,i){let c={k:e.target.value};if(n=await this.add_parameters(n,c),c.k.length>=o){let r=await this.aget_api(n);if(r.length){let n=JSON.parse(r);await this.autocomplete(e.target.value,t,n,l,s,i)}}}async autocomplete(e,t,n,r=20,a=!1,o){let l=t;a&&(l=document.querySelector(a)),!1===Array.isArray(n)&&(n=[n]);var s=this;let i=[],c=[];for(let e in n){let t=Object.values(n[e]);i=i.concat(t)}for(let e in i){if("object"!=typeof i[e]){c=i;break}c.push(i[e][0])}document.addEventListener("click",function(e){s.close_all_lists(e.target)}),s.close_all_lists();const u=l.id?l.id:l.name,d=l.offsetTop+l.offsetHeight+1,p=l.offsetLeft;let m=document.createElement("DIV");m.setAttribute("id",u+"_autocomplete-list"),m.setAttribute("class","autocomplete-items"),m.style.top=d+"px",m.style.left=p+"px",l.parentNode.appendChild(m);let f=0;for(let n=0;n<c.length&&!(f>r);n++)if("inline"===o){let r=c[n].toUpperCase().indexOf(e.toUpperCase());if(r>-1){let a=document.createElement("DIV"),o=c[n].substr(r,e.length);a.innerHTML=c[n].replace(o,"<strong>"+o+"</strong>"),a.innerHTML+="<input type='hidden' value='"+c[n]+"'>",a.innerHTML+="<input type='hidden' value='"+c[n]+"'>",a.addEventListener("click",function(e){t.value=this.getElementsByTagName("input")[0].value,s.close_all_lists(this)}),m.appendChild(a),f++}}else if(c[n].substr(0,e.length).toUpperCase()==e.toUpperCase()){let r=document.createElement("DIV");r.innerHTML="<strong>"+c[n].substr(0,e.length)+"</strong>",r.innerHTML+=c[n].substr(e.length),r.innerHTML+="<input type='hidden' value='"+c[n]+"'>",r.addEventListener("click",function(e){t.value=this.getElementsByTagName("input")[0].value,s.close_all_lists(this)}),m.appendChild(r),f++}}add_active(e){if(!e)return!1;this.remove_active(e),currentFocus>=e.length&&(currentFocus=0),currentFocus<0&&(currentFocus=e.length-1),e[currentFocus].classList.add("autocomplete-active")}remove_active(e){for(var t=0;t<e.length;t++)e[t].classList.remove("autocomplete-active")}close_all_lists(e){let t=document.getElementsByClassName("autocomplete-items");for(let e=0;e<t.length;e++)t[e].parentNode.removeChild(t[e])}post_textfield_rows(e,t,n){let r=this;document.querySelector("#"+e).closest("form").onsubmit=function(){return r._post_textfield_rows(this,e,t,n),!1}}async _post_textfield_rows(e,t,n,r){let a=await vwu.get_form_data(e),o=JSON.parse(decodeURIComponent(a[t]));data=await vwu.apost_api(n,JSON.stringify(o)),window[r](data)}async get_form_data(e){let t=e.getElementsByTagName("input"),n=[];for(let e=0;e<t.length;e++)["text","email","tel","time","url","week","password","number","month","hidden","datetime-local","date","color"].includes(t[e].type)&&n.push(encodeURIComponent(t[e].name)+"="+encodeURIComponent(t[e].value.trim())),"radio"==t[e].type&&t[e].checked&&n.push(encodeURIComponent(t[e].name)+"="+encodeURIComponent(t[e].value.trim())),"checkbox"==t[e].type&&t[e].checked&&n.push(encodeURIComponent(t[e].name)+"="+encodeURIComponent(t[e].value.trim()));let r=e.getElementsByTagName("textarea");for(let e=0;e<r.length;e++){let t=r[e].value.split("\n"),a=[];for(let e=0;e<t.length;e++){let n=t[e].trim();n?a.push(n):a.push("")}if(a.length){""===a[a.length-1].trim()&&a.pop();let t=JSON.stringify(a);n.push(encodeURIComponent(r[e].name)+"="+encodeURIComponent(t))}}const a=e.getElementsByTagName("select");if(a.length>0)for(let e=0;e<a.length;e++){let t=a[e].value.trim();if("select-multiple"==a[e].type){const t=get_select_values(a[e]);n.push(encodeURIComponent(a[e].name)+"="+encodeURIComponent(t))}else n.push(encodeURIComponent(a[e].name)+"="+encodeURIComponent(t))}let o={};for(let e=0;e<n.length;e++){let t=n[e].split("=");2===t.length&&(o[t[0]]=t[1])}return o}s_fill_select(e,t){this.fill_select(e,t)}async fill_select(e,t,n="",r=!1,a=!1){for(const r in t){let a=t[r],o=t[r];"object"==typeof t[r]&&2===t[r].length&&(a=t[r][0],o=t[r][1]);let l=document.createElement("option");a==n&&l.setAttribute("selected","selected"),l.value=a,l.innerHTML=o,e.appendChild(l)}r&&e.addEventListener("change",function(){let t=e.options[e.selectedIndex].value;navigator.clipboard.writeText(t),a&&a.info("copy to clipboard")})}pad(e){return e<10?"0"+e:e}s_set_selected(e,t){this.set_selected(e,t)}async set_selected(e,t){for(const n of e.querySelectorAll("option")){const e=n.value;-1!==t.indexOf(e)?n.setAttribute("selected","selected"):n.removeAttribute("selected")}}async adelete_api(e,t=!1){let n="application/x-www-form-urlencoded",r=null;return t&&(n="application/json;charset=UTF-8",r=t),new Promise((t,a)=>{let o=new XMLHttpRequest;o.open("DELETE",e),o.setRequestHeader("Content-type",n),o.onload=()=>t(o.responseText),o.onerror=()=>a(o.statusText),o.send(r)})}textarea_line_counter(e=!1,t=!1){let n=this,r=document.querySelector("#"+e),a=document.querySelector("#"+t);if(r&&a){let e=r.value.split("\n").length;a.innerHTML=""+e,r.addEventListener("change",function(){n._textarea_line_counter(r,a)}),r.addEventListener("keyup",function(){n._textarea_line_counter(r,a)}),r.addEventListener("keydown",function(){n._textarea_line_counter(r,a)})}}_textarea_line_counter(e=!1,t=!1){if(e&&t){let n=e.value.split("\n").length;t.innerHTML=""+n}}};